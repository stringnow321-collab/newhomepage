<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Checkout | Clone Cartel</title>
    <link rel="stylesheet" href="cart.css">
</head>

<body>
    <!-- TOP BAR -->
    <div class="top-bar">
        <div class="top-left">
            <img src="project2/images/logo.png" class="logo-img">
        </div>

        <div class="top-right">
            <input type="text" class="search-input" placeholder="Search...">
            <button class="search-btn">Search</button>
            <a href="cart.html" class="cart-icon">

                ðŸ›’ <span id="cart-count">0</span>
            </a>
        </div>
    </div>

    <!-- NAV MENU BAR -->
    <nav class="navbar">

        <ul id="MenuItems">
            <li class="dropdown">
                <a href="#">CLONES</a>
                <ul class="dropdown-menu">
                    <li><a href="cloness.html"> Clones</a></li>
                    <li><a href="exoticclones.html">Exotics</a></li>

                </ul>
            </li>

            <li class="dropdown">
                <a href="#">TEENS</a>
                <ul class="dropdown-menu">
                    <li><a href="comingsoonpages.html">Teens</a></li>
                    <li><a href="comingsoonpages.html">Exotics</a></li>

                </ul>
            </li>

            <li class="dropdown">
                <a href="#">SEEDS</a>
                <ul class="dropdown-menu">
                    <li><a href="seeds.html">Seeds</a></li>
                    <li><a href="exoticseeds.html">Exotic Seeds</a></li>
                </ul>
            </li>

            <li class="dropdown">
                <a href="#">GROW SUPPLY</a>
                <ul class="dropdown-menu">
                    <li><a href="growsupply.html">Grow Supply</a></li>
                </ul>
            </li>

            <li class="dropdown">
                <a href="#">MERCH</a>
                <ul class="dropdown-menu">
                    <li><a href="merch.html">Merchandise</a></li>
                </ul>
            </li>
        </ul>
    </nav>


    <h2 style="text-align:center;margin-bottom:20px;">Shipping Information</h2>

    <form id="checkout-form" name="submit-to-google-sheet">
        <div class="formgroup">
            <label for="name">Name:</label>
            <input class="formcontrol" type="text" name="name" id="name" placeholder="Name" required />
        </div>
        <div class="formgroup">
            <label for="email">Email:</label>
            <input class="formcontrol" type="email" name="email" id="email" placeholder="Email" required />
        </div>

        <div class="form-group">
            <label for="slip">Contact Number:</label>
            <input class="form-control" type="text" name="contact_number" id="contact_number"
                placeholder="Contact Number" required />
        </div>

        <div class="formgroup">
            <label for="address">Address:</label>
            <input class="formcontrol" type="text" name="address" id="address" placeholder="Address" required />
        </div>

         <div class="formgroup">
            <label for="City">City:</label>
            <input class="formcontrol" type="text" name="City" id="City" placeholder="City" required />
        </div>

         <div class="formgroup">
            <label for="State">State:</label>
            <input class="formcontrol" type="text" name="State" id="State" placeholder="State" required />
        </div>


        <div class="formgroup">
            <label for="zip">Zip Code:</label>
            <input class="formcontrol" type="text" name="zipcode" id="zipcode" placeholder="Zip Code" required />
        </div>

        <div class="total-row">
            <label>Total</label>
            <input type="text" id="payment_total" name="payment_total" readonly>
        </div>


        <div class="form-group form-check mt-2">
            <input class="form-check-input" type="checkbox" id="age" />
            <label class="form-check-label" for="age">Check if you are over 18 years old</label>
        </div>
        <div class="form-group form-check">
            <input class="form-check-input" type="checkbox" id="ex" required />
            <label class="form-check-label" for="ex">By checking this box I certify that I am agree with the data
                terms and policies.
            </label>
        </div>
        <button type="submit" class="checkout-btn">
            Continue to Payment
        </button>

    </form>



    <div class="footer">
        <p style="text-align:center;">Clone Cartel Holding Co</p>
    </div>



    <script>
        function getCart() {
            return JSON.parse(localStorage.getItem("cart")) || [];
        }

        function updateCartIcon() {
            const cart = getCart();
            const count = cart.reduce((sum, item) => sum + item.qty, 0);
            document.getElementById("cart-count").textContent = count;
        }

        updateCartIcon();
    </script>

    <script>



        function calculateCartTotal() {
            const cart = getCart();

            const BULK_QTY = 10;
            const BULK_PRICE = 20;

            let totalQty = 0;
            let subtotal = 0;

            cart.forEach(item => totalQty += item.qty);

            cart.forEach(item => {
                const price = totalQty >= BULK_QTY ? BULK_PRICE : item.price;
                subtotal += price * item.qty;
            });

            const tax = subtotal * 0.08;
            const total = subtotal + tax;

            return total.toFixed(2);
        }

        // Display total in payment form
        document.addEventListener("DOMContentLoaded", () => {
            const total = calculateCartTotal();
            const totalInput = document.getElementById("payment_total");
            if (totalInput) {
                totalInput.value = `$${total}`;
            }
        });


    </script>

    <script src="cart.js"></script>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbwvJcg4WvCrlCEpgI1Od2Ar7AXKVyIl7YccCozRhOcQkIcbMGmJqc4f_vXRWM9UFNMW/exec"; // Replace with your Apps Script URL
        const form = document.getElementById("checkout-form");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const ageChecked = document.getElementById("age").checked;
            if (!ageChecked) {
                swal("Error", "You must confirm you are over 18.", "error");
                return;
            }

            const exChecked = document.getElementById("ex").checked;
            if (!exChecked) {
                swal("Error", "You must agree to the data terms and policies.", "error");
                return;
            }

            const formData = new FormData(form);
            formData.append("age", ageChecked ? "Yes" : "No");
            formData.append("ex", exChecked ? "Yes" : "No");

            try {
                const response = await fetch(scriptURL, { method: "POST", body: formData });
                const text = await response.text();

                let data;
                try { data = JSON.parse(text); }
                catch (err) {
                    console.error("Invalid JSON response:", text);
                    swal("Error", "Server returned invalid response.", "error");
                    return;
                }

               if (data.result === "success") {

    // âœ… Clear cart
    localStorage.removeItem("cart");

    // âœ… Update cart icon (optional but clean)
    document.getElementById("cart-count").textContent = "0";

    // âœ… Redirect
    window.location.href = "finalcheckoutpage.html";
}

                else {
                    swal("Error", "Failed to submit data: " + data.error, "error");
                }

            } catch (error) {
                console.error("Fetch error:", error);
                swal("Error", "Something went wrong. Please try again!", "error");
            }
        });

    </script>


</body>

</html>
